<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Build System</title><link rel="stylesheet" type="text/css" href="static/docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="COMP_hack: The Definitive Guide" /><link rel="up" href="ch04.html" title="Chapter 4. Hacker's Guide" /><link rel="prev" href="ch04s01.html" title="Code Branches and Tags" /><link rel="next" href="ch04s03.html" title="Architecture Overview" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Build System</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04s01.html">Prev</a> </td><th width="60%" align="center">Chapter 4. Hacker's Guide</th><td width="20%" align="right"> <a accesskey="n" href="ch04s03.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp46852517694320"></a>Build System</h2></div></div></div><p>This project uses <a class="ulink" href="https://www.cmake.org" target="_top">CMake</a> to generate the make files (on Linux) or project files (for Visual Studio) needed to build the server applications and utilities. Currently this is known working on Linux with make files or Ninja scripts as well as Visual Studio 2015. The software may be build-able with new versions of Visual Studio, Eclipse, Xcode or other platforms and build systems; however, these have not been tested yet and may require slight modifications. It is known to build with the GCC, Clang and MSVC compilers.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp46852521207168"></a>Dependencies</h3></div></div></div><p>Dependencies are handled automatically by the CMake build scripts. There is four ways you can handle this:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Extract pre-built binaries into a <span class="emphasis"><em>binaries</em></span> directory in the root folder for the project.</p></li><li class="listitem"><p>Place zip files of the dependency source code in the <span class="emphasis"><em>deps</em></span> directory in the root folder for the project.</p></li><li class="listitem"><p>Let the CMake scripts download the source zip files from GitHub.</p></li><li class="listitem"><p>Let the CMake scripts download the source from the GitHub repositories. To do this you must set <code class="code">-DGIT_DEPENDENCIES=ON</code> when generating the build scripts.</p></li></ol></div><p>Except in the case of pre-built binaries, the CMake script will build the external projects and then import the libraries into the build environment. The imported libraries should include the interface include directories needed to use in a project that links to them. For details on how these are built and where to add a new dependency, see <span class="emphasis"><em>cmake/external.cmake</em></span> as well as <span class="emphasis"><em>cmake/binaries.cmake</em></span>. When building the Debian package the source code needs to be included for the build to succeed (especially if building for a PPA). When adding a dependency be sure to update the <span class="emphasis"><em>contrib/sources.sh</em></span> script to download the new dependency for these packages.</p><p>Dependencies are built static with the same build configuration as the main project. For MSVC you may use the static runtime as well by setting -DUSE_STATIC_RUNTIME=ON when generating the build scripts.</p><p>There is two dependencies that are not built external. One is <span class="emphasis"><em>sqlite</em></span> which is included as a single file in the <span class="emphasis"><em>deps/sqlite3</em></span> directory. The other is <span class="emphasis"><em>sqrat</em></span> which consists of a series of template based headers. The <span class="emphasis"><em>sqrat</em></span> dependency can fluctuate quite a bit so it was included as a submodule in the <span class="emphasis"><em>deps/sqrat</em></span> directory. Be sure to initialize and update this submodule.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp46852510545872"></a>Automated Builds</h3></div></div></div><p>The project is setup to create automated builds for Linux and Windows using <a class="ulink" href="https://travis-ci.org" target="_top">Travis CI</a> and <a class="ulink" href="https://www.appveyor.com" target="_top">AppVeyor</a> respectively. The scripts used to build the project in these environments can be found in the root directory of the project as <span class="emphasis"><em>.travis.yml</em></span> and <span class="emphasis"><em>.appveyor.yml</em></span> respectively. These builds are done in two to four stages: the external dependencies, objgen (optional), libobjects (optional) and the main project.</p><p>First, there is an <a class="ulink" href="https://github.com/comphack/external" target="_top">external project repository</a> that is also built in the same way as the main project. This has a mirror copy of the <span class="emphasis"><em>cmake/external.cmake</em></span> script. This will build and zip up the pre-compiled binaries. This is then added as a release for that <a class="ulink" href="https://github.com/comphack/external/releases" target="_top">GitHub project</a>. The Windows build may need to be added manually. The scripts are then updated by a developer to point to the new release. Then the automated builds will run using these pre-built binaries to speed up the build process.</p><p>The <a class="ulink" href="https://github.com/comphack/objgen" target="_top">objgen utility and library</a> can now be built as a separate project to speed up the automated builds. This is built and added to the main build in a similar fashion to the external project. It needs the external project just like the main build.</p><p>The <a class="ulink" href="https://github.com/comphack/libobjects" target="_top">objects library</a> can now be built as a separate project to speed up the automated builds. This contains a copy of the object schema in libcomp. Both projects should be updated when this schema changes. This is built and added to the main build in a similar fashion to the external project. It needs the external project just like the main build. It also needs the objgen utility and library build mentioned above.</p><p>The automated builds may use Cotire for pre-compiled headers (PCH) and combine multiple small source files into a single file to speed up the build process. Usually the Linux GCC build on Travis CI is the most picky when it comes to warnings followed by Clang. The Visual Studio build emits warnings but does not error out when they are generated.</p><p>The Windows build on AppVeyor will generate the zip and msi releases as artifacts that you may download and test with. These are used during the release process as the clean build of the project.</p><p>Finally, if you merge code from <span class="emphasis"><em>develop</em></span> into the <span class="emphasis"><em>coverity_scan</em></span> branch it will run a static analysis of the code provided by <a class="ulink" href="https://scan.coverity.com/" target="_top">Coverity</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp46852519973280"></a>Build Options</h3></div></div></div><p>Here is a list of build options you may set when running CMake:</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852509485888"></a>BUILD_DREAM</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> ON</p><p>This will build the dream and sandman sub-projects if they are cloned into the source tree as the directories <span class="emphasis"><em>dream</em></span> and <span class="emphasis"><em>tools/sandman</em></span> respectively.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852511617280"></a>GIT_DEPENDENCIES</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> OFF</p><p>This will download the external dependencies from the Git repositories instead of downloading a zip release. The branch for each external is specified in the <span class="emphasis"><em>cmake/external.cmake</em></span> file.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852511621392"></a>SINGLE_SOURCE_PACKETS</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> OFF</p><p>This will combine all the packet parsing source files into a single source file for fast building. Enabling this option could cause issues depending on how the source was written; however, these issues are usually caught during the automated build.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852513404720"></a>SINGLE_OBJGEN</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> OFF</p><p>This will combine all the objgen generated source files into a single source file for fast building. This is currently not used because of circular dependencies on the template functions used to bind the objects into the scripting language (squirrel).</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852513408480"></a>USE_COTIRE</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> OFF</p><p>This will use Cotire to generate and build using a pre-compiled header (PCH). This is used by the automated builds to speed up the build process.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852519323200"></a>NO_WARNINGS</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> OFF</p><p>This will disable the generation of errors when a warning is omitted. The warnings will still be shown but will not halt the build. This is handy when building on a new Linux system or for the Debian package (for the PPA). This should not be used during development or on the automated build system.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852519327008"></a>DISABLE_TESTING</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> OFF</p><p>This disables the build for the unit test applications.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852518174880"></a>USE_STATIC_RUNTIME</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> OFF</p><p>This disables the build for the unit test applications.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852518178368"></a>USE_PREBUILT_LIBCOMP</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> OFF</p><p>This will use the pre-built objgen and libcomp libraries and tools to speed up the build process. This was added to prevent timeout of the automated builds.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852518182032"></a>GENERATE_DOCUMENTATION</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> ON for Linux; OFF for Windows</p><p>This will enable or disable generation of the Doxygen API documentation and the Docbook guide you are reading now. If enabled, these only generate if the tools needed are found on the system.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852521931376"></a>WINDOWS_SERVICE</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> OFF</p><p>This will build the server applications as Windows services instead of a standalone application. This option is turned on for the AppVeyor build for official releases but may not be useful when developing.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852521935088"></a>COVERALLS</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> OFF</p><p>This will generate code coverage to be uploaded to Coveralls. This is meant to be used on a Linux host.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46852521938688"></a>BUILD_OPTIMIZED</h4></div></div></div><p><span class="strong"><strong>Type:</strong></span> boolean</p><p><span class="strong"><strong>Default:</strong></span> ON</p><p>This will built in release mode with aggressive optimizations. This should improve server performance but may not work for very very old systems. It may be useful to disable this when building for development for better debugging information.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04s01.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch04.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch04s03.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Code Branches and Tags </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Architecture Overview</td></tr></table></div></body></html>