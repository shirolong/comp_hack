<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>COMP_hack: libcomp - The COMP_hack library for just about everything.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="reflogo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">COMP_hack
   </div>
   <div id="projectbrief">Shin Megami Tensei Online: IMAGINE Server Emulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">libcomp - The COMP_hack library for just about everything. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>libcomp provides code used by multiple applications in the COMP_hack suite. Features include: encryption and decryption of both client data and the network protocol, parsing and writing client data files, packet handling, compression, string conversion, and scripting.</p>
<h1><a class="anchor" id="enc_and_dec"></a>
Encryption and Decryption</h1>
<p>Include the following header to use the encryption and decryption methods: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Crypto_8h.html">Crypto.h</a>&gt;</span></div>
</div><!-- fragment --><p> Client files can be read using Decrypt::decryptFile and written using Decrypt::encryptFile. These methods will handle any encryption the files may be using. If you do not wish to specify the language you may call the language methods directly: Decrypt::decryptFileJP, Decrypt::decryptFileUS, Decrypt::encryptFileJP, and Decrypt::encryptFileUS.</p>
<p>The network protocol uses Blowfish in electronic codeblock (ECB) mode. The server and client must first agree upon a key using the Diffie-Hellman key exchange. The private key used in this exchange can be generated with the Decrypt::generateRandom method. Calculating the public key and shared secret can be done using the Decrypt::genDiffieHellman method. The key exchange works as follows:</p>
<ul>
<li>The server uses a pre-determined base and prime number. These values can remain the same for the life of the code.</li>
<li>The server generates a private key using Decrypt::generateRandom.</li>
<li>The server generates a public key using Decrypt::genDiffieHellman like so: <div class="fragment"><div class="line">QString serverPublic = genDiffieHellman(base, prime, serverPrivate);</div>
</div><!-- fragment --></li>
<li>The server sends the base, prime, and public key to the client. Note that if the base and prime never change, the client can assume their values without the need to wait for the server. This doesn't work for the server emulator but it is used for the more compact protocol used in other applications in the suite.</li>
<li>The client generates a private key using Decrypt::generateRandom.</li>
<li>The client generates a public key using Decrypt::genDiffieHellman like so: <div class="fragment"><div class="line">QString clientPublic = genDiffieHellman(base, prime, clientPrivate);</div>
</div><!-- fragment --></li>
<li>The client sends the public key to the server.</li>
<li>Both the client and server may calculate the shared secret using Decrypt::genDiffieHellman like so: <div class="fragment"><div class="line">QString sharedSecret = genDiffieHellman(providedPublic, prime,</div>
<div class="line">    calculatedPrivate);</div>
</div><!-- fragment --></li>
<li>The first 8 bytes of the shared secret are used for a Blowfish key.</li>
</ul>
<p>The server should only have it's own generated private key and vice versa. Sending a private key would allow anyone to calculate the shared secret. For more information see the Decrypt documentation, the network code, and the guide. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
